/*! sdk-js - v1.7.10 - 2015-05-26
* Copyright (c) 2015 Schibsted Payment AS; */
"object"!=typeof JSON&&(JSON={}),function(){"use strict";function f(a){return 10>a?"0"+a:a}function quote(a){return escapable.lastIndex=0,escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,g,h=gap,i=b[a];switch(i&&"object"==typeof i&&"function"==typeof i.toJSON&&(i=i.toJSON(a)),"function"==typeof rep&&(i=rep.call(b,a,i)),typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";if(gap+=indent,g=[],"[object Array]"===Object.prototype.toString.apply(i)){for(f=i.length,c=0;f>c;c+=1)g[c]=str(c,i)||"null";return e=0===g.length?"[]":gap?"[\n"+gap+g.join(",\n"+gap)+"\n"+h+"]":"["+g.join(",")+"]",gap=h,e}if(rep&&"object"==typeof rep)for(f=rep.length,c=0;f>c;c+=1)"string"==typeof rep[c]&&(d=rep[c],e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));else for(d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));return e=0===g.length?"{}":gap?"{\n"+gap+g.join(",\n"+gap)+"\n"+h+"}":"{"+g.join(",")+"}",gap=h,e}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(a){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(a,b,c){var d;if(gap="",indent="","number"==typeof c)for(d=0;c>d;d+=1)indent+=" ";else"string"==typeof c&&(indent=c);if(rep=b,b&&"function"!=typeof b&&("object"!=typeof b||"number"!=typeof b.length))throw new Error("JSON.stringify");return str("",{"":a})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&"object"==typeof e)for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(d=walk(e,c),void 0!==d?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),function(a){"undefined"!=typeof module&&module.exports?module.exports=a(this):window.VGS=window.VGS||a(this)}(function(a){var b={version:"1.7.10",client_id:!1,redirect_uri:"undefined"!=typeof window?window.location.toString():"",_session:null,_sessionInitiated:!1,_userStatus:"unknown",_logging:!1,_prod:!0,_varnish_expiration:!1,_refresh_timeout:9e5,_timeout:5e3,_cache:!0,_cache_notloggedin:!1,_cacheLastReset:(new Date).getTime(),_track_throttle:1,_track_anon_opt_out:!1,_track_opt_out:!1,_track_custom_data:null,callbacks:[],cachedResponses:[],guid:function(){return"f"+(Math.random()*(1<<30)).toString(16).replace(".","")},copy:function(a,b,c,d){for(var e in b)(c||"undefined"==typeof a[e])&&(a[e]=d?d(b[e]):b[e]);return a},init:function(c){var d=!0;if(c=b.copy(c||{},{cache:b._cache,cache_notloggedin:b._cache_notloggedin,prod:b._prod,varnish_expiration:b._varnish_expiration,refresh_timeout:b._refresh_timeout,logging:b._logging,timeout:b._timeout,track_throttle:b._track_throttle,track_custom_data:b._track_custom_data,cookie:!0,status:!1,https:!0}),b._logging=c.logging,(!c.logging&&window.location.toString().indexOf("vgs_debug=1")<0||!a.console)&&(b._logging=!1),c.refresh_timeout>=6e4&&(b._refresh_timeout=c.refresh_timeout),b.Cookie.enabled=c.cookie,b._prod=c.prod,b._varnish_expiration=c.varnish_expiration,b._cache=c.cache,b._cache_notloggedin=c.cache_notloggedin,b.Ajax.timeoutPeriod=c.timeout,b._track_throttle=c.track_throttle,b._track_anon_opt_out=c.track_anon_opt_out,b._track_custom_data=c.track_custom_data,b.log('Default connection timeout set to ("'+b.Ajax.timeoutPeriod+'")',"log"),"undefined"==typeof c.client_id&&(b.log("VGS.init: client_id is missing!","error"),d=!1),"undefined"==typeof c.server&&(b.log("VGS.init: server is missing!","error"),d=!1),d){b.client_id=c.client_id,b.Ajax.serverUrl=(c.https?"https":"http")+"://"+c.server+"/",b._prod?(b.Ajax.sessionUrl=(c.https?"https":"http")+"://session."+c.server+"/rpc/hasSession.js",b.Cookie.name="vgs_js_"+b.client_id):(b.Ajax.sessionUrl=(c.https?"https":"http")+"://"+c.server+"/ajax/hasSession.js",b.Cookie.name="vgs_js_test_"+b.client_id),b.log('VGS.init("'+b.client_id+", "+b.Ajax.serverUrl+'")',"log");var e=null,f=null;if(b.Cookie.enabled&&(f=b.Cookie.get()),null!=c.session?(b.log("VGS.init: Session object provided! Expires in "+c.session.expiresIn+" seconds","log"),e=c.session):null!=f?(b.log("VGS.init: Cookie set! Expires in "+f.expiresIn+" seconds","log"),e=f,b.Auth._loadState="loaded"):b.log("VGS.init: No session set! Status unknown.","log"),"object"==typeof e&&null!=e){var g=parseInt(b.Ajax.now(),10),h=parseInt(1e3*e.expiresIn,10);if("undefined"!=typeof e.clientTime){var i=parseInt((e.clientTime+h-g)/1e3,10);e.expiresIn="number"==typeof i&&i>0?i:e.expiresIn,b.log("VGS.init: Session expiration updated to "+e.expiresIn+" seconds","log")}b.Auth.setSession(e,"undefined"!=typeof e.userStatus?e.userStatus:"unknown"),c.status===!0&&b.getLoginStatus()}else(c.status||null===e)&&b.getLoginStatus()}},processing:function(a){b.log('VGS.processing("'+a+'")',"log")},log:function(c,d){b._logging&&("error"===d?b.Event&&("string"==typeof c&&(c={type:"default",description:c,code:400}),b.Event.fire("VGS.error",c)):a.console&&a.console.log(c)),b.Event&&b.Event.fire("VGS.log",c)},Ajax:{connectionId:-1,connections:[],interval:null,intervalPeriod:300,pollingDebugCount:0,pollingDebugFirst:!0,pollingDebugThrottle:100,requestQueue:[],scriptObject:null,serverUrl:"",sessionUrl:"",timeoutPeriod:5e3,version:"1.0",getFragmentFromUrl:function(a){a=a||window.location.href,b.log('VGS.Ajax.getFragmentFromUrl("'+a+'")',"log");var c=a.replace(/^[^#]*#?(.*)$/,"$1");return b.log("-- complete fragment: "+c,"log"),c},buildConnectionUrl:function(a){b.log('VGS.Ajax.buildConnectionUrl("'+a+'")',"log"),b.Ajax.connectionId=b.Ajax.connections.length;var c=("http"===a.substr(0,4)?a:b.Ajax.serverUrl+a)+"&connectionId="+b.Ajax.connectionId+"&client_id="+b.client_id+"&redirect_uri="+encodeURIComponent(b.redirect_uri);b.log("-- built url: ["+c+"]","log"),b.Ajax.requestQueue[b.Ajax.requestQueue.length]=new b.Ajax.requestQueueNode(c)},buildUrl:function(a,c){var d=[];for(var e in c)c[e]&&d.push(e+"="+c[e]);var f=b.Ajax.serverUrl+a+"?"+d.join("&");return b.log("-- built url: ["+f+"]","log"),f},createScriptObject:function(a){b.log('VGS.Ajax.createScriptObject("'+a+'")',"log"),b.Ajax.scriptObject=document.createElement("SCRIPT"),b.Ajax.scriptObject.src=a,b.Ajax.scriptObject.type="text/javascript",b.Ajax.scriptObject.onerror=b.Ajax.loadingError;var c=document.getElementsByTagName("HEAD")[0];c.appendChild(b.Ajax.scriptObject)},failure:function(a){b.log('VGS.Ajax.failure("'+a+'")',"log"),b.Event&&b.Event.fire("VGS.error",{type:"communication",code:503,description:a})},flushQueue:function(){b.log("VGS.Ajax.flushQueue()","log"),b.Ajax.requestQueue.length=0},makeRequest:function(){if(b.log("VGS.Ajax.makeRequest()","log"),b.Ajax.requestQueue.length>0){b.processing("on");var a=b.Ajax.requestQueue[0].connectionUrl;parent.triggerResponse=null,b.Ajax.createScriptObject(a),b.Ajax.serverTimeoutTime=b.Ajax.now()+b.Ajax.timeoutPeriod}},now:function(){return b.log("VGS.Ajax.now()","log"),(new Date).getTime()},poll:function(){b.log("VGS.Ajax.poll()","log"),b.Ajax.pollingDebugCount===b.Ajax.pollingDebugThrottle?(b.log("-- poll ["+b.Ajax.now()+"] (x"+b.Ajax.pollingDebugCount+")","log"),b.Ajax.pollingDebugCount=0):b.Ajax.pollingDebugFirst&&(b.log("-- poll ["+b.Ajax.now()+"]","log"),b.Ajax.pollingDebugFirst=!1,b.Ajax.pollingDebugCount=0),b.Ajax.pollingDebugCount++,b.Ajax.serverTimeoutTime?b.Ajax.serverTimeoutTime<=b.Ajax.now()?(b.Ajax.stopPolling(),b.Ajax.failure("Server Timed Out")):null!=parent.triggerResponse&&parent.triggerResponse():b.Ajax.requestQueue.length>0?b.Ajax.requestQueue.length>10?(b.Ajax.failure("Queue size too big: "+b.Ajax.requestQueue.length+" requests! In order to avoid abuse and overload of the platform we allow max 10 requests in the queue."),b.Ajax.stopPolling()):b.Ajax.makeRequest():b.Ajax.stopPolling()},removeScriptObject:function(){b.log("VGS.Ajax.removeScriptObject()","log"),b.Ajax.scriptObject.parentNode.removeChild(b.Ajax.scriptObject),b.Ajax.scriptObject=null},requestQueueNode:function(a){b.log('VGS.Ajax.requestQueueNode("'+a+'")',"log"),this.connectionUrl=a,this.requestSent=!1},responseReceived:function(){b.log("VGS.Ajax.responseReceived()","log"),b.processing("off"),b.Ajax.requestQueue.shift(),b.Ajax.serverTimeoutTime=null,b.Ajax.removeScriptObject()},send:function(a){b.log('VGS.Ajax.send("'+a+'")',"log"),b.Ajax.buildConnectionUrl(a),b.Ajax.startPolling()},startPolling:function(){b.log("VGS.Ajax.startPolling()","log"),null==b.Ajax.interval&&(b.log("polling (re)started"),b.Ajax.connections[b.Ajax.connectionId]=null,b.Ajax.poll(),b.Ajax.interval=window.setInterval(function(){b.Ajax.connections[b.Ajax.connectionId]=null,b.Ajax.poll()},b.Ajax.intervalPeriod))},stopPolling:function(){b.log("VGS.Ajax.stopPolling()","log"),b.Ajax.serverTimeoutTime=null,b.Ajax.flushQueue(),b.Ajax.interval&&window.clearInterval(b.Ajax.interval),b.Ajax.interval=null},success:function(a){a.success?b.log("SUCCESS: "+a.success,"log"):a.error&&(b.log("ERROR: "+a.error,"log"),b.Event&&b.Event.fire("VGS.error",{type:"response",code:400,description:a.error}))},loadingError:function(){b.log("VGS.Ajax.loadingError()","log"),b.Ajax.stopPolling(),b.Ajax.failure("Server Timed Out")}},Cookie:{enabled:!0,name:"",domain:"",decode:function(a){return JSON.parse(window.unescape(a))},encode:function(a){return window.escape(JSON.stringify(a))},set:function(a){return b.log("VGS.Cookie.set()","log"),a?(b.Cookie.setRaw(b.Cookie.encode(a),a.expiresIn,a.baseDomain,b.Cookie.name),a.sp_id&&(b._varnish_expiration||(b._varnish_expiration=a.expiresIn),b.Cookie.setRaw(a.sp_id,b._varnish_expiration,a.baseDomain,"SP_ID"))):b.Cookie.clear(),a},get:function(){b.log("VGS.Cookie.get() -- "+b.Cookie.name,"log");var a,c,d,e=null;d=b.Cookie.name+"=",e=document.cookie.split(";");for(var f=0;f<e.length;f++){for(var g=e[f];" "===g.charAt(0);)g=g.substring(1,g.length);0===g.indexOf(d)&&(a=g.substring(d.length,g.length))}return a&&(c=b.Cookie.decode(a),c.expiresIn=parseInt(c.expiresIn,10),c.clientTime=parseInt(c.clientTime,10),b.Cookie.domain=c.baseDomain),c},setRaw:function(a,c,d,e){b.log("VGS.Cookie.setRaw(val, "+c+", "+d+", "+e+")","log");var f="";if("undefined"==typeof e&&(e=b.Cookie.name),b.Cookie.domain=d,"undefined"!=typeof c){var g=new Date;g.setTime(g.getTime()+1e3*c),f="; expires="+g.toGMTString(),document.cookie=e+"="+a+f+"; path=/"+(d?"; domain=."+d:"")}else b.log("VGS.Cookie.setRaw() expiration is invalid:"+c+", no cookie set)","log")},clear:function(){b.log("VGS.Cookie.clear() "+b.Cookie.name,"log"),b.Cookie.setRaw("",0,b.Cookie.domain),b.log("VGS.Cookie.clear() SP_ID","log"),b.Cookie.setRaw("",0,b.Cookie.domain,"SP_ID")}},Auth:{valid:!1,logout:function(a){b.log("VGS.Auth.logout","log"),b.Auth.setSession(null,"unknown");var c="";"function"==typeof a&&(c=b.guid(),b.callbacks[c]=a),b.Ajax.send("ajax/logout.js?callback="+c)},validate:function(a){b.log("VGS.Auth.validate","log"),b.Auth.valid=!1,b._track_opt_out=a.tracking?!1:!0,b.log("VGS._track_opt_out: "+b._track_opt_out,"log"),b.log(a,"log"),a.result?("undefined"!=typeof a.visitor&&b.Event.fire("auth.visitor",a.visitor),b.Auth.valid=a.result,b.log("SUCCESS: "+b.Auth.valid,"log"),b.Auth.valid&&"undefined"!=typeof a.userId?(b.log("-- valid session, allow login","log"),b.Auth.setSession(a,"undefined"!=typeof a.userStatus?a.userStatus:"unknown")):(b.log("-- invalid session, do not allow login","log"),b.Auth.setSession(null,"unknown"))):a.error&&a.response?("undefined"!=typeof a.response.visitor&&b.Event.fire("auth.visitor",a.response.visitor),"LoginException"===a.error.type?(b.log(a.error,"log"),b.Event.fire("VGS.loginException",a)):(b.log(a.error,"error"),b._cache_notloggedin?(a.response.expiresIn=parseInt(b._refresh_timeout,10)/1e3,b.Auth.setSession(a.response,"unknown")):b.Auth.setSession(null,"unknown"))):(b.log(a,"error"),b.Auth.setSession(null,"unknown"))},setSession:function(a,c){b.log("VGS.Auth.setSession ("+typeof a+" , "+c+")","log");var d=!1,e=!1;"object"==typeof a&&null!==a&&a.hasOwnProperty("userId")&&(d=!0),"object"==typeof b._session&&null!==b._session&&b._session.hasOwnProperty("userId")&&(e=!0);var f=!e&&d,g=e&&!d,h=!e&&!d,i=e&&d&&b._session.id!==a.id,j=f||g||e&&d&&b._session.sig!==a.sig||h,k=c!==b._userStatus,l={session:a,status:c};return"object"==typeof a&&null!==a&&(a.clientTime=parseInt(b.Ajax.now(),10)),b._session=a,b._userStatus=c,j&&b.Cookie.enabled&&b.Cookie.set(a),h&&b.Event.fire("auth.notLoggedin",l),k&&b.Event.fire("auth.statusChange",l),(g||i)&&b.Event.fire("auth.logout",l),(f||i)&&b.Event.fire("auth.login",l),j&&b.Event.fire("auth.sessionChange",l),i&&b.Event.fire("auth.userChange",l),d&&!b._sessionInitiated&&(b._sessionInitiated=!0,b.Event.fire("auth.sessionInit",l)),b.Auth._refreshTimer&&(window.clearTimeout(b.Auth._refreshTimer),delete b.Auth._refreshTimer),b.Auth._loadState&&a&&a.expiresIn&&(b.log("--  refresh every "+b._refresh_timeout+" milliseconds","log"),b.Auth._refreshTimer=window.setTimeout(function(){b.getLoginStatus(null,!0)},b._refresh_timeout)),l}},getSession:function(){return b.log("VGS.getSession","log"),b._session},getLoginStatus:function(a,c){if(b.log("VGS.getLoginStatus("+a+","+c+")","log"),!b.client_id)return void b.log("ERROR: VGS.getLoginStatus() called before calling VGS.init().","error");c=c===!0;var d;if(a){if(!c&&"loaded"===b.Auth._loadState)return b.log("VGS.getLoginStatus(): status has already been loaded! "+b.Auth._loadState,"log"),void a({status:b._userStatus,session:b._session});b.log("VGS.Event.subscribe(VGS.loginStatus) "+b.Auth._loadState,"log"),"function"==typeof a?(d=b.guid(),b.callbacks[d]=a,b.Event.subscribe("VGS.loginStatus",b.callbacks[d])):b.Event.subscribe("VGS.loginStatus",a)}if(!c&&"loading"===b.Auth._loadState)return void b.log("VGS.getLoginStatus() already loading, returning..."+b.Auth._loadState,"log");b.Auth._loadState="loading";var e=function(a){b.log("VGS.callbacks -- "+b.Auth._loadState,"log"),b.Auth._loadState="loaded",b.Auth.validate(a),b.Event.fire("VGS.loginStatus",a),b.Event.clear("VGS.loginStatus")};d=b.guid(),b.callbacks[d]=e,b.Event.subscribe("VGS.loginException",function(){d=b.guid(),b.callbacks[d]=function(a){b.log("VGS.callbacks -- "+b.Auth._loadState,"log"),b.Auth._loadState="loaded",b.Auth.validate(a),b.Event.fire("VGS.loginStatus",a),b.Event.clear("VGS.loginStatus")},b.Event.clear("VGS.loginException"),b.Ajax.send("ajax/hasSession.js?callback="+d+"&autologin=1")}),b.Ajax.send(b.Ajax.sessionUrl+"?callback="+d)},hasProduct:function(a,c,d){if(b.log("VGS.hasProduct("+a+")","log"),!b.client_id)return void b.log("ERROR: VGS.hasProduct() called before calling VGS.init().","error");d=d===!0;var e=(new Date).getTime();if(b._cacheLastReset+b._refresh_timeout<e&&(b.log("VGS.hasProduct("+a+"): Cache timedout, forcing request.","log"),d=!0),!d&&"object"==typeof b.cachedResponses["prd_"+a]&&null!==b.cachedResponses["prd_"+a])return b.log("VGS.hasProduct("+a+"): Product cached.","log"),void c(b.cachedResponses["prd_"+a]);b.log("VGS.hasProduct("+a+"): Product NOT cached.","log");var f=function(d){b.cachedResponses["prd_"+a]=d,b._cacheLastReset=(new Date).getTime(),c(d)},g=b.guid();b.callbacks[g]=f,b.Ajax.send("ajax/hasproduct.js?product_id="+a+"&callback="+g)},hasSubscription:function(a,c,d){if(b.log("VGS.hasSubscription("+a+")","log"),!b.client_id)return void b.log("ERROR: VGS.hasSubscription() called before calling VGS.init().","error");d=d===!0;var e=(new Date).getTime();if(b._cacheLastReset+b._refresh_timeout<e&&(b.log("VGS.hasSubscription("+a+"): Cache timedout, forcing request.","log"),d=!0),!d&&"object"==typeof b.cachedResponses["sub_"+a]&&null!==b.cachedResponses["sub_"+a])return b.log("VGS.hasSubscription("+a+"): Product cached.","log"),void c(b.cachedResponses["sub_"+a]);b.log("VGS.hasSubscription("+a+"): Product NOT cached.","log");var f=function(d){b.cachedResponses["sub_"+a]=d,b._cacheLastReset=(new Date).getTime(),c(d)},g=b.guid();b.callbacks[g]=f,b.Ajax.send("ajax/hassubscription.js?product_id="+a+"&callback="+g)},setTraits:function(a,c){if(b.log("VGS.setTraits("+a+")","log"),!b.client_id)return void b.log("ERROR: VGS.setTraits() called before calling VGS.init().","error");var d=function(a){c(a)},e=b.guid();b.callbacks[e]=d,b.Ajax.send("ajax/traits.js?t="+a+"&callback="+e)},getLoginURI:function(a,c){var d={response_type:"code",client_id:c||b.client_id,redirect_uri:encodeURIComponent(a||window.location.toString())};return b.Ajax.buildUrl("flow/login",d)},getSignupURI:function(a,c){var d={response_type:"code",client_id:c||b.client_id,redirect_uri:encodeURIComponent(a||window.location.toString())};return b.Ajax.buildUrl("flow/signup",d)},getLogoutURI:function(a,c){var d={client_id:c||b.client_id,redirect_uri:encodeURIComponent(a||window.location.toString())};return b.Ajax.buildUrl("logout",d)},getAccountURI:function(a,c){var d={response_type:"code",client_id:c||b.client_id,redirect_uri:encodeURIComponent(a||window.location.toString())};return b.Ajax.buildUrl("account/summary",d)},getPurchaseHistoryURI:function(a,c){var d={response_type:"code",client_id:c||b.client_id,redirect_uri:encodeURIComponent(a||window.location.toString())};return b.Ajax.buildUrl("account/purchasehistory",d)},getSubscriptionsURI:function(a,c){var d={response_type:"code",client_id:c||b.client_id,redirect_uri:encodeURIComponent(a||window.location.toString())};return b.Ajax.buildUrl("account/subscriptions",d)},getProductsURI:function(a,c){var d={response_type:"code",client_id:c||b.client_id,redirect_uri:encodeURIComponent(a||window.location.toString())};return b.Ajax.buildUrl("account/products",d)},getRedeemVoucherURI:function(a,c,d){var e={response_type:"code",client_id:d||b.client_id,redirect_uri:encodeURIComponent(c||window.location.toString()),voucher_code:a||null};return b.Ajax.buildUrl("account/redeem",e)},getPurchaseProductURI:function(a,c,d){var e={response_type:"code",client_id:d||b.client_id,redirect_uri:encodeURIComponent(c||window.location.toString()),product_id:a||null};return b.Ajax.buildUrl("flow/checkout",e)},getPurchaseCampaignURI:function(a,c,d,e,f){var g={response_type:"code",client_id:f||b.client_id,redirect_uri:encodeURIComponent(e||window.location.toString()),campaign_id:a||null,product_id:c||null,voucher_code:d||null};return b.Ajax.buildUrl("flow/checkout",g)},getFlowUrl:function(a,c){c=b.copy(c,{client_id:b.client_id,redirect_uri:encodeURIComponent(window.location.toString()),response_type:"code"});var d="flow/"+a;return b.Ajax.buildUrl(d,c)},Event:{subscribers:function(){return this._subscribersMap||(this._subscribersMap={}),this._subscribersMap},subscribe:function(a,b){var c=this.subscribers();c[a]?c[a].push(b):c[a]=[b]},unsubscribe:function(a,c){var d=this.subscribers()[a];b.Array.forEach(d,function(a,b){a===c&&(d[b]=null)})},monitor:function(a,b){if(!b()){var c=this,d=function(){b.apply(b,arguments)&&c.unsubscribe(a,d)};this.subscribe(a,d)}},clear:function(a){delete this.subscribers()[a]},fire:function(){var a=Array.prototype.slice.call(arguments),c=a.shift();b.Array.forEach(this.subscribers()[c],function(d){d&&(b.log('VGS.Event.fire("'+c+'")',"log"),d.apply(this,a))})}},Array:{forEach:function(a,b,c){if(a)if("[object Array]"!==Object.prototype.toString.apply(a)&&(a instanceof Function||"number"!=typeof a.length))for(var d in a)(c||a.hasOwnProperty(d))&&b(a[d],d,a);else if(a.forEach)a.forEach(b);else for(var e=0,f=a.length;f>e;e++)b(a[e],e,a)}}};return"undefined"!=typeof window&&window.setTimeout(function(){"function"!=typeof window.vgsAsyncInit||window.vgsAsyncInit.hasRun||(window.vgsAsyncInit.hasRun=!0,window.vgsAsyncInit())},0),b}),function(a,b){function c(b,c,d){function e(){function c(a){for(;a.nodeName!==b.toUpperCase()&&9!==a.nodeType;)a=a.parentNode;return 1===a.nodeType?a:!1}function e(e){var f=e||a.event,g=f.target||f.srcElement,h="string"==typeof b?c(g):g;h&&d.call(h)}return a.addEventListener?function(a,b){a.addEventListener(b,e,!1)}:a.attachEvent?function(a,b){a.attachEvent("on"+b,e)}:function(b,c){var d=b["on"+c]?b["on"+c]:function(){};b["on"+c]=function(b){b||(b=a.event),d.call(this,b),e.call(this,b)}}}var f=e();"string"==typeof b?f(a.document,c):f(b,c)}function d(a,b,c){function d(d){var e=new Date;e.setDate(e.getDate()+b),e.setMinutes(e.getMinutes()+c);var f=d+"; expires="+e.toUTCString();document.cookie=a+"="+f}function e(){var b,c,d,e=document.cookie.split(";");for(b=0;b<e.length;b++)if(c=e[b].substr(0,e[b].indexOf("=")),d=e[b].substr(e[b].indexOf("=")+1),c=c.replace(/^\s+|\s+$/g,""),c===a)return d;return null}var f=e();return null===f&&(f="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"===a?b:3&b|8;return c.toString(16)})),d(f),f}function e(){return Math.random()<=g.throttlingFactor}function f(){function c(a){var b=a,c=a.document,d=c.documentElement,e=c.getElementsByTagName("body")[0],f=b.innerWidth||d.clientWidth||e.clientWidth,g=b.innerHeight||d.clientHeight||e.clientHeight;return f+"x"+g}function e(){return screen.width+"x"+screen.height}function f(){var a=document.documentElement,b=(window.pageXOffset||a.scrollLeft)-(a.clientLeft||0),c=(window.pageYOffset||a.scrollTop)-(a.clientTop||0);return b+"x"+c}function h(a){for(var b={},c=a.document.getElementsByTagName("meta"),d=0;d<c.length;d++){var e=c[d].getAttribute("name");(void 0===e||null===e)&&(e=c[d].getAttribute("property"));var f=c[d].getAttribute("content");b[e]=f}return b}function i(b){return a.encodeURIComponent(b)}function j(a,b){l.user_id=a||l.user_id,l.distinct_id=b||l.distinct_id}function k(d){if(b.log("pulse: vgs._track_opt_out","log"),b._track_opt_out||!l.user_id&&b._track_anon_opt_out)return null;var j,k=h(a),p={url:i(a.document.URL),uid:m,sid:n,a:o,t:g.throttlingFactor,spid:l.user_id,did:l.distinct_id,cid:b.client_id,ti:i(a.document.title),ref:i(a.document.referrer),vs:c(a),ss:e(a),ps:f(),mti:i(k.title),md:i(k.description),mta:i(k.tags),moti:i(k["og:title"]),moty:i(k["og:type"]),mou:i(k["og:url"]),moi:i(k["og:image"]),modes:i(k["og:description"]),moa:i(k["og:audio"]),modet:i(k["og:determiner"]),mol:i(k["og:local"]),mola:i(k["og:local:alternate"]),mosn:i(k["og:site_name"]),mov:i(k["og:video"]),cust:i(b.custom_data||b._track_custom_data)},q=[];for(j in d)p[j]=d[j];for(j in p)q.push(j+"="+p[j]);(new Image).src=g.pulseServer+"?"+q.join("&")}var l={user_id:0,distinct_id:0},m=d(g.cookiePrefix+"uid",365,0),n=d(g.cookiePrefix+"sid",0,15),o=(new Date).getTime();return{pulse:k,setUser:j}}var g={pulseServer:("https"===a.location.protocol.substr(0,5)?"https":"http")+"://pulse.spid.se/pulse",cookiePrefix:"spd_pls_",throttlingFactor:b._track_throttle||1},h=f(),i=!1;c("a","click",function(){if(e()){var b=this.getAttribute("href");b&&"http"===b.substr(0,4)&&(h.pulse({name:"page_exit",toUrl:a.encodeURIComponent(b),l:(new Date).getTime()}),i=!0)}}),c(a,"unload",function(){(e()||i)&&h.pulse({name:"page_exit",l:(new Date).getTime()})}),b.Event.subscribe("auth.visitor",function(a){e()&&(h.setUser(a.user_id,a.uid),h.pulse({name:"page_entry",r:(new Date).getTime()}))}),b.Event.track=function(a,b){h.pulse({name:a,cust:JSON.stringify(b)})}}(window,VGS);